---
title: "Another rvest exercise - cricbuzz"
output:
  html_document:
    df_print: paged
---

Something more topical this time. Let's scrape the IPL schedule.

Open this webpage in chrome and see: https://www.cricbuzz.com/cricket-series/2810/indian-premier-league-2019/matches

What all features can we scrape from here?

* date  
* team A
* team B
* venue
* match#
* time
* result
* etc.

Let's do this.

```{r}
# setup chunk

suppressPackageStartupMessages({
  
  if (!require(imager)){install.packages("imager")}
  library(imager) 
  library(rvest)
  library(XML)
  library(magrittr)
  library(stringr)

})

url = "https://www.cricbuzz.com/cricket-series/2810/indian-premier-league-2019/matches"
page = url %>% read_html()
```

### Extracting Teams that played

```{r}
teams.nodes = page %>% html_nodes(".text-hvr-underline span")
xmlTreeParse(teams.nodes[[1]])  # parse one node
```
Spot what is interesting enough to scrape above.

```{r}
teams.text = teams.nodes %>% html_text()
teams.text[1:5]   # view a few
```

Clearly, lotsa refining needed.

```{r}
# get teams A, B and matchNum
a0 = str_split(teams.text, " vs ") %>% unlist()

teamA_seq = seq(from=1, to=length(a0), by=2)  # try ?seq

teamA = a0[teamA_seq]
teamA[1:5]
```

```{r}
teamB_seq = seq(from=2, to=length(teams.text), by=2)
teamB = a0[teamB_seq]
teamB[1:5]
```

Uh-oh. More processing needed.

```{r}
# more processing needed
teamB1 = teamB %>% str_split(",") %>% unlist()
teamB1[1:5]
teamB_seq = seq(from=1, to=length(teamB1), by=2)
teamB = teamB1[teamB_seq]
teamB[1:5]

```
Finally, let's not forget match number.

```{r}
matchNum_seq = seq(from=2, to=length(teamB1), by=2)
matchNum = teamB1[matchNum_seq]
matchNum[1:5]
```

Look through SelectorGadget again and ID the tags we need to scrape venue and time pls.

```{r}
# getting venue and time
venues = page %>% html_nodes(".cb-col-60 .text-gray") %>% html_text()
times = page %>% html_nodes(".text-gray span+ span") %>% html_text()

venues[1:5]
times[1:5]
```

Above can be bound into a neat DF. Results below are partial since many matches are yet to be played.

```{r}
# getting results
results = page %>% html_nodes(".cb-text-complete") %>% html_text()
tail(results)
```

Last but not least, scraping images off of cricbuzz.

### Scrapiing images

```{r}
# scraping images off of cricbuzz

url1 = "https://www.cricbuzz.com/cricket-series/2810/indian-premier-league-2019/photos"
page1 = url1 %>% read_html()

img.urls1  = page1 %>% html_nodes(".cb-lst-img") %>% html_attr("src")
img.urls = paste0("https://www.cricbuzz.com",img.urls1)
head(img.urls)

download.file(img.urls[1], 'x.jpg', mode='wb')
```

Look in the 'Files' list, the image should have come.

Last but not least, will use `imager` to display the image thus stored.

```{r}
require(imager)
load.image("./x.jpg") %>% plot()
```


Chalo, signing off.

Sudhir

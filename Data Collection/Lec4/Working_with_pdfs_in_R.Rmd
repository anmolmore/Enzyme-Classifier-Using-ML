
---
title: "DC from PDF files in R"
output:
  html_document:
    df_print: paged
---

### Introduction

PDF files are great for multiple reasons like sharing your work with others, printing in different OS etc but they are very difficult to manage when it comes to extracting data from PDFs.   

Sometimes it takes a significant amount of our time for just manually copying data from PDF files to Excel or text files. In this article, I will discuss two R packages: 

*  [pdftools](https://cran.r-project.org/web/packages/pdftools/index.html) and   

*  [tabulizer](https://github.com/ropensci/tabulizer)  

for extracting data from pdf files to R work space.

The `pdftools` package is based on 'libpoppler' for extracting text, fonts, attachments and metadata from a PDF file. 

Also it supports high quality rendering of PDF documents info PNG, JPEG, TIFF format, or into raw bitmap vectors for further processing in R. 

The `tabulizer` package provides R bindings to the [Tabula](http://tabula.technology/) java library, which can be used to computationally extract tables from PDF documents.   

The tabulizer package is available on [GitHub](https://github.com/ropensci/tabulizer). It can be installed with *install_github* command from *"ghit"* package. Refer the code below for installation of both the packages in 64bit Windows R environment.   

Note that tabulizer package uses Tabula java library, so you need prior installation of 64bit Java in your computer. If you  don't have Java installed in your computer, then you should download Java setup file from this [link](https://java.com/en/download/manual.jsp) (Windows Offline (64-bit) setup file) and install Java before installing tabulizer package.  


```{r setup }
suppressPackageStartupMessages({
  
# Install pdftools package
if (!require(pdftools)) {install.packages("pdftools")}; library(pdftools)

if(!require(data.tree)){install.packages("data.tree")}; library(data.tree) 

if (!require(knitr)){install.packages("knitr")}; library(knitr)    
  
# if (!require(devtools)) {install.packages("devtools")}; library(devtools)

# if (!require(tabulizer)) {install.packages("tabulizer")}; library(tabulizer)
  
# Install tabulizer from github
if (!require(webp)) {install.packages("webp")}; library(webp)

   })

# first set your working directory
setwd('.')
getwd()    # check wd
```


### Working with pdf files in R

In this article I' wi'll use Alphabet's Form 10-K compliance filing, downloadable from this [link](https://abc.xyz/investor/pdf/20161231_alphabet_10K.pdf)  

Plan is to extract all the text from this 98 page pdf page by page. Say hello to the `pdf_text()` function form pdftools package.   

Below, we define the PDF's local location. Then use the `pdf_text` function to convert it to text format. Finally, print the first thousand characters from the 6th page of the pdf, using base R's `substr()` func.

```{r, message=FALSE}
# read in file path
pdf_file_path = './20161231_alphabet_10K.pdf'    # character

# extract pdf text
system.time({ txt <- pdf_text(pdf_file_path) })    # 0.58 secs

# First 1000 characters from Page 6 of text
cat(substr(txt[6], 1, 1000))
```


We can use `pdf_toc()` function to extract table of contents of the PDF file.

```{r toc}
# Table of contents
toc <- pdf_toc(pdf_file_path)

# Show as data.tree
require(knitr)
knitr::kable(as.Node(toc, mode="explicit", nameName="title"), format="rst")
```

Also we can use `pdf_info()` function to extract meta data associated with the PDF file. 

```{r}
# Author, version, etc, Metadata Extraction
info <- pdf_info(pdf_file_path)
info

```

### Saving as Images

The wonders continue. 

Say we wanna render of PDF files as bitmap arrays. Say hello to the `pdf_render_page()` function, to render a page of the PDF into a bitmap, which can be stored as e.g. png or jpeg.

```{r bitmap_arrays}

# renders pdf to bitmap array
bitmap <- pdf_render_page(pdf_file_path, page = 6)

# save bitmap image, will write to wd
png::writePNG(bitmap, "page6.png")
jpeg::writeJPEG(bitmap, "page6.jpeg", quality = 5)
webp::write_webp(bitmap, "page6.webp")
```

You can see the page6.jpeg file in the working directory.

Enough for now. 

Sudhir